星期一/星期二/星期四

10->12 吃饭 这段时间 看 JVM Spring 

12->1:30 健身房 锻炼 

1:45->6:00 写需求  看项目架构

6:00->6:30 吃饭

6:45->8:00 继续看JVM 并发 Spring

JVM 7/3 7/13 每天看29页 如果超出就快速进入下一专题

tiny Spring  7/14 7/24  边看边实现 一天一步

Java 编程艺术 7/24 8/1 



星期三/星期五

10->12 写需求 

12->1:30 健身房 锻炼 

1:45->6:00 写需求 看项目架构

6:00->6:30 吃饭

6:45->8:00 继续看JVM 并发 Spring



周末 

9:00 公司 JVM Spring 并发

中午吃饭 

1:30->6:00 写算法

6:00  下班 

晚上看剧放松 打游戏



什么是热修复？ 我们使用的集群服务器是RS上面 轮流kill 

主从库 ？

限权管理怎么做？

分布式锁？ setnx()函数 ？

```java
public CommonRet lockCluster(Integer clusterId,String value) {
		CommonRet ret =new CommonRet();
		String key = QLB_L4_REDIS_LOCK_PRE + clusterId;

		try {

			Integer redisTimeOut = qlbDeployService.getQlbRedisLockTimeOut();
			ret.setMsg(value);
			//分布式锁
			if (LockUtil.tryLock(key,value)) {
				LockUtil.expireKey(key, redisTimeOut);
			} else {
				logger.error("lockRedisJsonValueByKey " + key);
				ret.error(clusterEditingMsg);
			}
		} catch (Exception ex) {
			logger.error("cluster lock key:" + key +" " + ex.toString());
			ret.setCode(CommonRet.ERROR);
		}
		return ret;
	}
```

```java
public class LockUtil {
	private static Logger logger = LoggerFactory.getLogger(LockUtil.class);

	/**
	 *  分布式锁
	 * @param key
	 * @param value
	 * @return
	 */
	public static boolean tryLock(String key, String value) {
		Jedis client = null;
		try {
			client = RedisWritePool.getClient();
			if (client.setnx(key, value) == 1) {
				return true;
			}
		} catch (Exception ex) {
			logger.error("key:" + key + " value:" + value + "." + ex.toString(),ex);
		} finally {
			RedisWritePool.quitClient(client);
		}
		return false;
	}

	/**
	 *  分布式锁，添加重试次数
	 * @param key
	 * @param value
	 * @return
	 */
	public static boolean tryLock(String key, String value,Integer retryTimes) {
		for (Integer i=0;i<retryTimes;i++) {
			boolean flg = tryLock(key,value);
			if (flg) {
				return true;
			}
			try {
				Thread.sleep(1000);
			} catch (InterruptedException ex) {

			}
		}
		return false;
	}

	/**
	 * 根据key和key的value来解锁，防止解锁的值不是自己加锁的情况
	 * @param key
	 * @param value
	 */
	public static boolean unLockWithValue(String key,String value) {
		Jedis client = null;
		boolean flg = false;
		try {
			client = RedisWritePool.getClient();
			String oldValue = client.get(key);
			if (value.equals(oldValue)) {
				RedisWritePool.removeKey(client,key);
				flg = true;
			} else {
				logger.error("invalid delete key:" + key+ " value:" + value + ",old value "+oldValue);
			}
		} catch (Exception ex) {
			logger.error("key:"+key+ " value:"+value + "." + ex.toString(),ex);
		} finally {
			RedisWritePool.quitClient(client);
		}
		return flg;
	}

	/**
	 * 直接解锁
	 * @param key
	 */
	public static void unLock(String key) {
		Jedis client = null;
		try {
			client = RedisWritePool.getClient();
			RedisWritePool.removeKey(client,key);
		} catch (Exception ex) {
			logger.error(ex.toString(),ex);
		} finally {
			RedisWritePool.quitClient(client);
		}
	}



	/**
	 * 设置key存活时间
	 */
	public static boolean expireKey(String key,int seconds) {
		Jedis client = null;
		try {
			client = RedisWritePool.getClient();
			return RedisWritePool.expireKey(client, key, seconds);
		} catch (Exception ex) {
			logger.error(ex.toString(), ex);
		} finally {
			RedisWritePool.quitClient(client);
		}
		return false;
	}

	/**
	 * 判断锁是否存在
	 */
	public static boolean exists(String key) {
		Jedis client = null;
		try {
			client = RedisWritePool.getClient();
			return client.exists(key);
		} catch (Exception ex) {
			logger.error(ex.toString(), ex);
		} finally {
			RedisWritePool.quitClient(client);
		}
		return false;
	}

}

```

Redis 连接池？

使用的jedispool 进行封装

JVM 

什么是栈帧？

sync 锁降级？

JIT 编译器的发展？ 逃逸分析？

string intern 方法？

https://tech.meituan.com/2014/03/06/in-depth-understanding-string-intern.html